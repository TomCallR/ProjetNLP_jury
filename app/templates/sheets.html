{% from "macros.html" import render_field, render_submit %}

{% extends "base.html" %}

{% block content %}

<h1>Liste des onglets connus en base de données</h1>

<p>Chaque élément de la liste correspond à un onglet du fichier lié à la formation</p>
<p>Sont sélectionnés les onglets pour lesquels la date de dernière modification est
    antérieure de <strong>{{ form.daysnochange.data }}</strong> jours au plus à la date de dernière lecture
    (i.e. date de mise à jour)</p>
<p>Tous les onglets nouveaux non listés ici seront lus et les réponses intégrées en base de données</p>

<table class="table">
    <thead>
    <tr>
        <th>Sél.</th>
        <th>Id</th>
        <th>Formation</th>
        <th>Fichier</th>
        <th>Onglet</th>
        <th>Dern. saisie</th>
        <th>Dern. lecture</th>
        <th>Nb réponses</th>
    </tr>
    </thead>
    <tbody>
    {% for gform in gforms %}
    <tr>
        {% if gform.Form.sheetid == "" %}
            <td>-</td>
        {% else %}
            <td>{{ gform.check }}</td>
        {% endif %}
        <td>{{ gform.Course.id }}</td>
        <td>{{ gform.Course.label }}</td>
        {% if gform.Course.filename == "" %}
            <td>-</td>
        {% else %}
            <td>{{ gform.Course.filename }}</td>
        {% endif %}
        {% if gform.Form.sheetid == "" %}
            <td>-</td>
        {% else %}
            <td>{{ gform.Form.sheetlabel }}</td>
        {% endif %}
        {% if gform.Form is defined %}
            <td>{{ gform.Form.lastentrydt.date() }}</td>
            <td>{{ gform.Form.lastreaddt.date() }}</td>
            <td>{{ gform.answercount }}</td>
        {% else %}
            <td>-</td>
            <td>-</td>
            <td>-</td>
        {% endif %}
    </tr>
    {% endfor %}
    </tbody>
</table>

<form action="" class="form" method="post" novalidate>
    {{ form.hidden_tag() }}
    {{ render_field(form.daysnochange, class='form-control') }}
    {{ render_submit(form.submit, class="btn btn-warning btn-block") }}
</form>

<p>Cette page existe pour permettre de mettre à jour des onglets anciens au besoin</p>

{% endblock %}